#  File converted from Magma code -- requires editing and checking
#  Magma -> GAP converter, version 0.43, 4/04/16 by AH

#  Global Variables used: Append, Centraliser, Generators, Id, Image, Index,
#  IsConjugate, Ngens, Order, Random, RandomProcess, Socle, Sym,
#  get_standard_gens_u62, homom

#  Defines: U62Identify, get_standard_gens_u62

DeclareGlobalFunction("U62Identify@");

#  
#  Code for maximal subgroups of almost simple groups with socle U(6,2).
#  Data mostly from Rob Wilson's Birmingham Atlas.

get_standard_gens_u62@:=function(G)
#  /out: G is a group iso to U(6,2) /out: standard gens as defined in B'ham
#  Atlas /out: algorithm by Bill Unger, 4/12/2003 
local P,a,ab,b,ord,x,y;
  P:=RandomProcess(G);
  repeat
    x:=Random(P);
    ord:=Order(x);
    
  until ord in Set([10,18]);
  #   19 in 90
  a:=x^(QuoInt(ord,2));
  #   a is now in 2A
  repeat
    y:=Random(P);
    
  until Order(y)=7;
  #   1 in 42
  #   get a good b 
  repeat
    b:=y^Random(P);
    ab:=a*b;
    
  until Order(ab)=11 and Order(ab*b)=18;
  #   2 in 33
  return rec(val1:=a,
    val2:=b);
end;
;
InstallGlobalFunction(U62Identify@,
function(group)
local 
   CG,F,Im,M,M1,M2,M3,N,Print,S,a,au62,aut,b,c,c2,ce,d,g,ga,gb,group,h,homom,i,
   ims,isc,j,max,maximals,newgens,phi,soc,usimp;
  max:=ValueOption("max");
  if max=fail then
    max:=true;
  fi;
  Print:=ValueOption("Print");
  if Print=fail then
    Print:=0;
  fi;
  S:=SymmetricGroup(693);
  a:=(8,192)(11,158)(13,396)(14,194)(15,179)(17,87)(19,318)(21,79)(22,230)
   (23,313)(24,216)(25,136)(26,113)(27,240)(28,124)(29,128)(30,163)(31,156)
   (32,201)(33,255)(34,215)(35,444)(36,214)(37,141)(38,204)(39,48)(40,329)
   (41,86)(42,341)(43,76)(44,294)(45,310)(46,211)(47,59)(49,149)(50,241)(51,135)
   (52,104)(53,130)(54,275)(55,126)(56,200)(57,303)(58,144)(60,152)(61,205)
   (62,298)(63,247)(64,129)(65,552)(66,101)(67,338)(68,293)(69,307)(70,290)
   (71,94)(72,119)(73,140)(74,447)(75,234)(77,85)(78,459)(80,375)(81,246)
   (82,514)(83,245)(84,106)(88,112)(89,239)(90,339)(91,403)(92,236)(93,98)
   (95,210)(96,302)(97,356)(99,273)(100,213)(102,244)(103,408)(105,291)(107,155)
   (108,197)(109,202)(110,232)(111,280)(114,233)(115,446)(116,284)(117,508)
   (118,173)(120,174)(121,397)(122,181)(123,395)(125,306)(127,305)(131,203)
   (132,187)(133,368)(134,394)(137,153)(138,198)(139,309)(142,191)(143,485)
   (145,344)(146,184)(147,157)(148,621)(150,507)(151,343)(154,225)(159,189)
   (160,317)(161,417)(162,268)(164,640)(165,180)(166,311)(167,402)(168,340)
   (170,300)(171,353)(172,352)(175,342)(176,281)(177,449)(178,506)(182,370)
   (183,243)(185,188)(186,304)(190,223)(193,622)(195,248)(196,443)(199,265)
   (206,551)(207,278)(208,220)(209,266)(212,557)(217,289)(218,287)(219,476)
   (221,367)(222,505)(224,299)(226,257)(227,410)(228,249)(229,393)(231,322)
   (235,286)(237,323)(238,285)(242,550)(250,541)(251,429)(252,486)(253,267)
   (254,682)(256,679)(258,276)(259,296)(260,379)(261,462)(269,430)(270,292)
   (271,384)(272,409)(274,448)(277,478)(279,477)(282,481)(283,337)(288,385)
   (295,649)(297,617)(301,502)(308,641)(312,589)(314,645)(315,424)(316,556)
   (319,558)(320,372)(321,371)(324,354)(325,357)(327,345)(328,347)(330,421)
   (331,454)(332,348)(333,389)(334,369)(335,423)(336,646)(346,411)(349,383)
   (350,543)(351,437)(355,643)(359,398)(360,400)(362,510)(373,377)(376,555)
   (378,686)(380,559)(382,564)(386,594)(388,416)(390,537)(391,496)(399,683)
   (404,609)(405,613)(407,615)(412,672)(414,484)(418,563)(419,480)(422,436)
   (425,460)(431,565)(432,499)(433,566)(435,453)(439,532)(440,591)(442,644)
   (450,521)(451,493)(452,504)(455,494)(457,539)(469,525)(488,651)(490,685)
   (492,560)(500,596)(515,662)(518,592)(522,587)(528,608)(531,542)(548,570)
   (561,602)(597,663)(599,647)(601,673)(612,631)(624,659) #CAST S
    ;
  b:=(1,513,168,644,376,154,677)(2,76,42,12,353,159,114)
   (3,504,68,78,575,630,224)(4,66,219,98,339,422,624)(5,133,60,443,592,59,490)
   (6,381,522,166,620,142,21)(7,617,303,670,202,629,230)
   (8,205,315,100,246,149,74)(9,292,256,502,308,198,564)
   (10,681,380,508,118,512,454)(11,226,317,481,153,30,441)
   (13,427,191,165,215,432,611)(14,367,218,408,439,642,327)
   (15,91,333,272,667,559,81)(16,541,295,478,148,586,217)
   (17,82,85,26,530,279,242)(18,497,440,680,613,259,499)
   (19,523,452,323,403,160,386)(20,306,212,414,594,71,86)
   (22,483,655,158,391,45,580)(23,87,555,44,88,442,514)
   (24,27,489,368,54,618,587)(25,692,569,214,672,373,300)
   (28,123,543,510,144,691,475)(29,485,185,147,170,278,248)
   (31,115,542,110,69,577,235)(32,597,382,479,84,342,116)
   (33,552,507,64,517,241,228)(34,73,311,545,80,574,673)
   (35,178,659,661,674,48,351)(36,484,282,37,294,251,468)
   (38,600,299,169,477,150,128)(39,167,519,43,258,79,501)
   (40,357,604,146,240,593,410)(41,590,122,549,289,374,558)
   (46,325,466,650,658,388,516)(47,589,496,320,402,678,244)
   (49,560,141,225,639,340,425)(50,195,129,671,572,438,264)
   (51,318,571,430,688,445,101)(52,494,400,570,602,447,93)
   (53,326,591,693,463,419,579)(55,347,291,431,378,656,398)
   (56,229,135,94,132,293,486)(57,576,666,95,647,77,255)
   (58,606,416,616,544,553,171)(61,599,313,183,238,649,404)
   (62,324,595,286,260,208,578)(63,554,456,283,563,685,364)
   (65,550,243,173,605,527,297)(67,684,401,405,531,332,221)
   (70,421,372,437,343,637,651)(72,506,433,379,350,596,689)
   (75,200,435,665,227,233,262)(83,663,111,276,180,335,287)
   (89,143,290,328,521,584,428)(90,548,608,459,669,682,209)
   (92,365,573,653,298,565,525)(96,393,476,192,108,535,345)
   (97,152,679,377,99,406,223)(102,134,493,472,509,265,654)
   (103,646,266,104,451,426,457)(105,354,473,319,187,237,370)
   (106,131,641,126,330,310,635)(107,469,557,412,301,448,567)
   (109,420,270,196,409,664,415)(112,460,179,182,450,534,462)
   (113,687,269,538,662,207,249)(117,285,172,561,492,137,213)
   (119,121,609,197,634,181,660)(120,309,336,643,621,361,161)
   (124,344,322,631,623,556,625)(125,236,470,390,139,532,529)
   (127,612,614,526,211,615,174)(130,474,358,268,164,588,562)
   (136,547,239,204,610,636,515)(138,280,341,633,482,413,359)
   (140,216,645,175,267,446,296)(145,201,369,176,284,231,349)
   (151,675,628,648,396,581,222)(155,686,603,366,316,676,568)
   (156,384,536,337,360,436,566)(157,273,652,491,539,245,334)
   (162,177,302,453,627,247,498)(163,503,487,331,392,210,424)
   (184,314,203,274,585,540,465)(186,640,583,199,598,234,399)
   (188,281,253,271,467,582,488)(189,329,407,622,668,288,362)
   (190,371,657,375,387,464,619)(193,690,511,385,500,638,417)
   (194,411,348,346,232,304,449)(206,356,275,495,461,254,355)
   (220,471,434,537,305,383,395)(250,352,528,252,683,307,632)
   (257,389,518,394,455,418,312)(261,429,363,520,524,458,607)
   (263,546,601,423,338,626,480)(277,551,321,533,505,444,397) #CAST S
    ;
  c:=(2,3,5)(4,7,12)(6,10,18)(8,14,26)(9,16,20)(11,21,37)(13,24,44)(15,28,52)
   (17,31,39)(19,34,62)(22,40,73)(23,42,46)(25,47,84)(27,50,90)(29,53,94)
   (30,55,98)(32,58,75)(33,60,100)(35,65,115)(36,68,64)(38,70,125)(41,76,135)
   (43,51,86)(45,81,145)(48,87,156)(49,89,92)(54,96,138)(56,101,173)(57,103,91)
   (59,106,136)(61,109,174)(63,112,189)(66,118,200)(67,121,117)(69,123,178)
   (71,128,130)(72,131,127)(74,133,219)(77,137,223)(78,139,227)(79,141,158)
   (80,143,229)(82,148,150)(83,151,147)(85,153,190)(88,159,247)(93,163,126)
   (95,166,260)(99,171,266)(102,175,220)(104,179,124)(105,181,278)(107,183,225)
   (108,184,284)(110,185,270)(111,187,289)(113,192,194)(114,195,191)
   (116,197,146)(119,203,305)(120,205,202)(122,207,291)(129,214,293)
   (132,217,280)(134,222,221)(140,230,329)(142,233,248)(144,234,201)
   (149,239,236)(152,213,255)(154,155,243)(157,245,343)(160,249,345)
   (161,251,347)(162,253,352)(164,256,242)(165,258,224)(167,259,360)
   (168,226,325)(170,265,285)(172,268,267)(176,271,370)(177,206,308)
   (180,276,299)(182,281,384)(186,287,372)(188,292,232)(193,295,254)
   (196,274,376)(198,275,302)(199,238,300)(204,290,306)(208,244,342)
   (209,273,353)(210,311,379)(211,313,341)(212,314,316)(215,298,318)
   (216,294,396)(218,320,304)(228,327,317)(231,330,279)(235,333,432)
   (237,335,337)(240,241,339)(246,344,310)(250,348,453)(252,350,269)
   (257,357,340)(261,324,425)(262,364,361)(272,373,288)(277,380,334)
   (282,386,321)(283,323,423)(286,389,499)(296,400,402)(297,355,399)
   (301,405,496)(303,408,403)(307,395,506)(309,410,459)(312,331,433)
   (315,414,398)(319,411,521)(322,421,477)(328,417,429)(332,435,541)
   (336,440,431)(338,397,508)(346,450,558)(349,455,351)(354,460,462)
   (358,465,461)(359,424,484)(362,469,388)(363,471,467)(365,474,584)
   (366,475,428)(367,394,505)(368,476,447)(369,478,559)(371,481,594)
   (375,485,393)(377,385,409)(378,488,597)(381,487,413)(382,492,504)
   (383,494,437)(390,422,532)(391,502,613)(401,463,513)(404,515,596)
   (406,516,441)(407,419,518)(412,522,624)(416,510,525)(418,528,631)
   (426,470,534)(430,486,543)(434,497,607)(436,439,537)(438,544,520)
   (442,539,548)(443,448,555)(444,552,446)(445,553,509)(449,551,641)
   (451,561,531)(452,564,560)(454,566,589)(456,569,653)(457,570,644)
   (458,572,482)(464,524,628)(466,575,554)(468,579,578)(473,581,634)
   (479,590,533)(480,592,615)(490,601,599)(493,602,542)(495,605,603)
   (500,609,662)(501,611,567)(503,616,610)(507,514,621)(512,574,656)
   (517,625,623)(519,549,523)(526,630,655)(529,632,545)(530,598,638)
   (535,580,595)(538,637,606)(550,640,679)(556,557,645)(563,608,612)
   (565,646,591)(582,636,681)(587,659,672)(588,661,633)(593,660,678)
   (604,670,669)(614,676,692)(617,643,683)(620,629,642)(622,649,682)
   (626,680,668)(647,685,673)(648,674,666)(651,663,686)(654,687,665)
   (664,675,688)(677,693,684) #CAST S
    ;
  d:=(2,567)(3,611)(4,675)(5,501)(6,678)(7,664)(8,398)(9,553)(10,660)(11,444)
   (12,688)(13,389)(14,414)(15,357)(16,445)(17,87)(18,593)(19,591)(20,509)
   (21,446)(22,400)(23,560)(24,286)(25,136)(26,315)(27,112)(28,257)(29,110)
   (30,55)(31,48)(32,510)(33,291)(34,646)(35,158)(36,129)(37,552)(38,570)
   (39,156)(40,296)(41,121)(42,564)(43,338)(44,499)(45,477)(46,452)(47,106)
   (49,91)(50,63)(51,508)(52,340)(53,270)(54,197)(56,200)(57,92)(58,416)(59,84)
   (60,207)(61,205)(62,565)(64,214)(65,141)(66,173)(67,76)(68,293)(69,419)
   (70,457)(71,188)(72,203)(73,402)(74,556)(75,525)(77,161)(78,594)(79,115)
   (80,376)(81,421)(82,150)(83,372)(85,417)(86,397)(88,240)(89,103)(90,189)
   (94,185)(95,199)(96,116)(99,191)(100,122)(101,118)(104,168)(105,255)(107,602)
   (108,275)(109,120)(111,380)(113,424)(114,266)(117,135)(119,131)(123,407)
   (124,226)(125,644)(126,163)(127,305)(128,232)(130,292)(132,478)(133,645)
   (134,622)(137,347)(138,146)(139,481)(140,167)(142,273)(143,274)(144,388)
   (145,322)(147,186)(149,403)(151,287)(152,278)(153,328)(154,531)(155,561)
   (157,304)(159,339)(160,249)(162,685)(164,423)(165,272)(166,300)(169,576)
   (170,311)(171,195)(172,601)(174,202)(175,220)(176,515)(177,436)(178,518)
   (179,325)(180,409)(181,213)(182,500)(183,493)(184,198)(187,277)(190,429)
   (192,359)(193,394)(194,484)(196,229)(201,362)(204,548)(206,537)(208,342)
   (209,233)(210,265)(211,504)(212,476)(215,336)(216,235)(217,369)(218,343)
   (219,557)(221,649)(222,682)(223,251)(224,373)(225,542)(227,371)(228,317)
   (230,360)(231,344)(234,469)(236,303)(237,679)(238,260)(239,408)(241,247)
   (242,283)(243,451)(245,320)(246,330)(248,353)(250,332)(252,486)(253,647)
   (254,505)(256,323)(258,288)(259,329)(262,554)(263,546)(264,600)(267,599)
   (268,490)(269,543)(271,404)(276,385)(279,310)(280,559)(281,662)(282,309)
   (284,302)(285,379)(289,334)(290,539)(294,432)(295,367)(297,383)(298,431)
   (299,377)(301,597)(306,442)(307,480)(308,439)(312,433)(313,492)(314,368)
   (316,447)(318,440)(319,659)(321,410)(324,425)(326,489)(333,396)(335,640)
   (337,550)(341,382)(346,522)(348,541)(349,617)(350,430)(351,643)(352,673)
   (354,460)(355,437)(358,461)(361,466)(363,381)(364,575)(365,680)(366,516)
   (370,596)(374,618)(375,555)(378,496)(384,609)(386,459)(387,573)(390,551)
   (391,686)(392,586)(393,443)(395,615)(399,494)(401,598)(405,488)(406,475)
   (411,587)(412,450)(413,471)(420,671)(422,449)(426,549)(428,441)(435,453)
   (438,625)(448,485)(455,683)(456,538)(458,634)(463,530)(464,603)(467,487)
   (468,578)(470,519)(472,639)(473,482)(474,626)(479,512)(483,619)(495,628)
   (497,607)(498,690)(502,663)(503,616)(506,592)(507,514)(511,627)(513,638)
   (517,544)(520,623)(521,672)(523,534)(524,605)(526,588)(527,657)(528,631)
   (529,614)(532,641)(533,574)(535,595)(540,547)(545,676)(558,624)(562,667)
   (566,589)(569,606)(571,585)(572,581)(577,658)(582,642)(583,691)(584,668)
   (590,656)(604,677)(608,612)(613,651)(620,681)(629,636)(630,633)(632,692)
   (635,650)(637,653)(648,674)(654,687)(655,661)(669,693)(670,684) #CAST S
    ;
  #  
  #  a,b are standard generators of U(6,2).
  #  c,d are outer auts of order 3,2 resp., such that d inverts c.
  
  #  *************************************************************************
  if Print > 1 then
    Print("Setting up standard group");
  fi;
  usimp:=SubStructure(S,a,#TODO CLOSURE
    b);
  usimp.Order:=9196830720;
  F:=SubGroup(a,b,[a^2,b^7,(a*b)^11,Tuple([a,b])^2,Tuple([a,b^2])
   ^3,Tuple([a,b^3])^3,(a*b^3)^11,(a*b*a*b^2*a*b^3*a*b^-3)^7]);
  phi:=GroupHomomorphismByImages(F,usimp,
    a,b);
  soc:=Socle(group);
  aut:=Index(group,soc);
  if Print > 1 then
    Print("group is U(6,2):[%o]\n",aut);
  fi;
  if Print > 1 then
    Print("Getting embedding");
  fi;
  # =v= MULTIASSIGN =v=
  gb:=get_standard_gens_u62@(soc);
  ga:=gb.val1;
  gb:=gb.val2;
  # =^= MULTIASSIGN =^=
  soc:=SubStructure(soc,ga,#TODO CLOSURE
    gb);
  soc.Order:=9196830720;
  newgens:=[ga,gb];
  for g in Generators(group) do
    if not g in SubStructure(group,newgens) then
      Add(newgens,g);
    fi;
  od;
  group:=SubStructure(group,newgens);
  au62:=SubStructure(S,a,#TODO CLOSURE
    b,c,d);
  ims:=[a,b];
  homom:=GroupHomomorphismByImages(soc,usimp,
    GeneratorsOfGroup(soc),ims);
  for i in [Ngens(soc)+1..Ngens(group)] do
    g:=group.i;
    CG:=au62;
    ce:=One(au62);
    for j in [1..2] do
      # =v= MULTIASSIGN =v=
      h:=IsConjugate(CG,usimp.j^ce,homom(soc.j^g));
      isc:=h.val1;
      h:=h.val2;
      # =^= MULTIASSIGN =^=
      if not isc then
        Error("Conjugation error in Aut(U(6,2))");
      fi;
      CG:=Centraliser(CG,homom(soc.j^g));
      ce:=ce*h;
    od;
    Add(ims,ce);
  od;
  newgens:=ims;
  for g in Generators(au62) do
    if not g in SubStructure(au62,ims) then
      Add(ims,g);
    fi;
  od;
  au62:=SubStructure(S,ims);
  homom:=GroupHomomorphismByImages(group,au62,
    GeneratorsOfGroup(group),newgens);
  maximals:=[];
  if not max then
    return rec(val1:=homom,
      val2:=au62,
      val3:=maximals,
      val4:=F,
      val5:=phi);
  fi;
  if Print > 1 then
    Print("Constructing maximal subgroups");
  fi;
  #   first construct maximals common to all the grps 
  M:=SubStructure(usimp,a,#TODO CLOSURE
    b^2*a*b^2);
  #   U(5,2)
  M.Order:=13685760;
  Add(maximals,M);
  M:=SubStructure(usimp,Tuple([a,b]),#TODO CLOSURE
    b*a*b^5*a*b^4);
  #   2^(1+8):U(4,2)
  M.Order:=13271040;
  Add(maximals,M);
  M:=SubStructure(usimp,Tuple([a,b]),#TODO CLOSURE
    b*a*b*a*b^4);
  #   2^9:L(3,4)
  M.Order:=10321920;
  Add(maximals,M);
  M:=SubStructure(usimp,(a*b^2*a*b^3*a*b^3*a*b^3)^3,#TODO CLOSURE
    a*b^3*a*b^3*a*b^2*a*b^3);
  #   2^(4+8):(S3 × A5)
  M.Order:=1474560;
  Add(maximals,M);
  M:=SubStructure(usimp,Tuple([a,b]),#TODO CLOSURE
    b*a*b*a*b*a*b^5*a*b^5);
  #   U(4,2) x S3
  M.Order:=155520;
  Add(maximals,M);
  M:=SubStructure(usimp,a*b^2,#TODO CLOSURE
    ((b^-1*x^-1*b*x)^3*b^-1)^2*b^-1*x*b*x*b^-1*x*b*x^-1*b^-1*x^-1*b*x^-1*b^-1);
  #  POSTPONED `where'
  x:=(a*b*b)^6;
  #   3^(1+4):(Q8 × Q8):S3
  M.Order:=93312;
  Add(maximals,M);
  M:=SubStructure(usimp,Tuple([a,b]),#TODO CLOSURE
    a*b*a*b*a*b^5*a*b^3*a*b^2*a*b^4);
  #   L(3,4):2_1
  M.Order:=40320;
  Add(maximals,M);
  #   now for the different aut grps 
  if aut <= 2 then
    #   maximals of usimp which are usimp-conjugate to their d-conjugate 
    M1:=SubStructure(usimp,a,#TODO CLOSURE
      b*a*b*a*b^2*a*b^2*a*b^3);
    #   U(4,3):2
    M1.Order:=6531840;
    M2:=SubStructure(usimp,a,#TODO CLOSURE
      b*a*b^4*a*b^3*a*b);
    #   S(6,2)
    M2.Order:=1451520;
    M3:=SubStructure(usimp,Tuple([a,b]),#TODO CLOSURE
      a*b*a*b*a*b^2*a*b^3*a*b^5);
    #   M22
    M3.Order:=443520;
    c2:=c^2;
    if aut=1 then
      maximals:=Concatenation(maximals,[M1,M1^c,M1^c2,M2,M2^c,M2^c2,M3,M3^c,
       M3^c2]);
      return rec(val1:=homom,
        val2:=au62,
        val3:=maximals,
        val4:=F,
        val5:=phi);
    else
      #   which conjugates do we want? 
      Im:=Image(homom);
      if d in Im then
        maximals:=Concatenation(maximals,[M1,M2,M3]);
      elif d^c in Im then
        maximals:=Concatenation(maximals,[M1^c,M2^c,M3^c]);
      else
        Assert(1,d^c2 in Im);
        maximals:=Concatenation(maximals,[M1^c2,M2^c2,M3^c2]);
      fi;
      return rec(val1:=homom,
        val2:=au62,
        val3:=maximals,
        val4:=F,
        val5:=phi);
    fi;
  else
    #   novelties arise here 
    N:=SubStructure(usimp,[[1,2,2,2,1,-2,-2,-2,-1],[1,-2,-2,-2,1,2,2,2,-1]
     ,[-2,1,2,2,1,2,2,1,2,1,2,-1,-2,-2,-2,-1,2,2,-1,-2]]@phi);
    #   3^4:S6
    N.Order:=58320;
    Add(maximals,N);
    N:=SubStructure(usimp,[[2,1,-2,-2,-2,1,-2,1,-2,-2,1,-2,-2,1,-2,-2,-1,-2,-2,
     -1,-2,-2,-1,2,2,-1,2,-1]
     ,[1,-2,-2,1,2,2,1,2,2,1,2,1,-2,-2,-2,1,2,2,2,-1,2,-1,2,2,-1,2,2,-1,-2,-1,
     -2,-1]]@phi);
    N.Order:=1512;
    Add(maximals,N);
    return rec(val1:=homom,
      val2:=au62,
      val3:=maximals,
      val4:=F,
      val5:=phi);
  fi;
end);


